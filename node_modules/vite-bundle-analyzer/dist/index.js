"use strict";var be=Object.create;var A=Object.defineProperty;var ze=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,ke=Object.prototype.hasOwnProperty;var Ae=(e,t)=>{for(var r in t)A(e,r,{get:t[r],enumerable:!0})},q=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Se(t))!ke.call(e,n)&&n!==r&&A(e,n,{get:()=>t[n],enumerable:!(i=ze(t,n))||i.enumerable});return e};var m=(e,t,r)=>(r=e!=null?be(we(e)):{},q(t||!e||!e.__esModule?A(r,"default",{value:e,enumerable:!0}):r,e)),Pe=e=>q(A({},"__esModule",{value:!0}),e);var Xe={};Ae(Xe,{adapter:()=>fe,analyzer:()=>qe,default:()=>qe});module.exports=Pe(Xe);var k=m(require("path")),U=m(require("fs/promises")),V=m(require("picocolors"));var B="vite-bundle-analyzer";var E=m(require("os")),X=m(require("child_process")),je="microsoft";function Me(e){switch(e){case"linux":return E.default.release().toLocaleLowerCase().indexOf(je)!==-1?["win32","cmd.exe"]:["linux","xdg-open"];case"win32":return["win32","cmd.exe"];case"darwin":return["darwin","open"];default:return[e,"xdg-open"]}}function Q(e){let[t,r]=Me(E.default.platform());return t==="win32"&&(e=e.map(i=>i.replace(/[&^]/g,"^$&")),e=["/c","start",'""'].concat(e)),X.default.spawn(r,e)}var W=m(require("fs/promises")),D=m(require("path"));var I=m(require("zlib")),ee=m(require("util")),j=m(require("fs")),O=m(require("fs/promises")),S=m(require("path"));function Y(e){let t=["Bytes","KB","MB","GB","TB"];if(!e)return"0 "+t[0];let r=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<r*10)).toFixed(2)+" "+t[r]}function P(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}var ve=ee.default.promisify(I.default.gzip),Te={level:I.default.constants.Z_DEFAULT_LEVEL},x=M(S.default.join(__dirname,"client")),te=M(S.default.join(x,"assets"));function re(e={}){return e=Object.assign(Te,e),t=>ve(t,e)}function M(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function L(e){return typeof e=="string"?new TextEncoder().encode(e):e}async function ne(e){let t=await Promise.all((await O.default.readdir(e)).map(n=>S.default.join(e,n))),r=0,i=[];for(;r!==t.length;){let n=t[r],o=await O.default.stat(n);if(o.isDirectory()){let a=await O.default.readdir(n);t.push(...a.map(s=>S.default.join(n,s)))}o.isFile()&&i.push(n),r++}return i}function Ce(e){try{return j.default.statSync(e,{throwIfNoEntry:!1})}catch{}}function ie(e){if(!Ce(e))return!1;try{return j.default.accessSync(e,j.default.constants.R_OK),!0}catch{return!1}}function v(e){let t=e.injectTo==="head"?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;e.descriptors=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors];let r=e.descriptors.map(i=>`<${i.kind}>${i.text}</${i.kind}>`);return e.html.replace(t,i=>`${r.join(`
`)}${i}`)}function G(e,t){let{stringify:r}=JSON;return`window.defaultSizes = ${r(t)},window.foamModule = ${r(e)};`}async function oe(e,t){let r=await ne(te),n=(await Promise.all(r.map(async a=>{let s=D.default.extname(a).replace(".",""),c=await W.default.readFile(a,"utf8");return{fileType:s,content:c}}))).filter(a=>["js","css"].includes(a.fileType)),o=await W.default.readFile(D.default.join(x,"index.html"),"utf8");return o=o.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,""),o=o.replace(/<link\b[^>]*rel="stylesheet"[^>]*>/gi,""),o=o.replace(/<title>(.*?)<\/title>/,`<title>${t.title}</title>`),o=v({html:o,injectTo:"head",descriptors:n.map(({fileType:a,content:s})=>({kind:a==="js"?"script":"style",text:s}))}),o=v({html:o,injectTo:"body",descriptors:{kind:"script",text:G(e,t.mode)}}),o}var T=m(require("fs")),b=m(require("path"));var Ne=["pnpm-workspace.yaml","lerna.json"];function Fe(e){let t=b.default.join(e,"package.json");if(!ie(t))return!1;try{return!!(JSON.parse(T.default.readFileSync(t,"utf-8"))||{}).workspaces}catch{return!1}}function Re(e){return Ne.some(t=>T.default.existsSync(b.default.join(e,t)))}function Be(e){let t=b.default.join(e,"package.json");return T.default.existsSync(t)}function se(e,t=e){if(Be(e))return e;let r=b.default.dirname(e);return!r||r===e?t:se(r,t)}function w(e,t=se(e)){if(Re(e)||Fe(e))return e;let r=b.default.dirname(e);return!r||r===e?t:w(r,t)}var z=m(require("path"));var C=class{kind;meta;filename;children;groups;isEndOfPath;constructor(t){this.kind=t?.kind||"stat",this.meta=t?.meta||{},this.filename=t?.filename||"",this.children=new Map,this.groups=[],this.isEndOfPath=!1}},$=class{root;constructor(t){this.root=new C(t)}insert(t,r){let i=this.root,n=t.split("/").filter(Boolean);for(let o of n)i.children.has(o)||i.children.set(o,Ee({...r,filename:o})),i=i.children.get(o);i.isEndOfPath=!0}mergePrefixSingleDirectory(t=this.root){for(let[r,i]of t.children.entries()){if(i.isEndOfPath)break;if(i.children.size>1){this.mergePrefixSingleDirectory(i);continue}t.children.delete(r);for(let[n,o]of i.children.entries())t.children.set(`${r}/${n}`,o),o.isEndOfPath||this.mergePrefixSingleDirectory(o)}}walk(t,r){if(t.children.size){for(let[i,n]of t.children.entries()){let o={...n.meta,id:i,label:i,groups:n.groups};if(n.isEndOfPath&&delete o.groups,r(o,t),this.walk(n,r),o.groups&&o.groups.length)switch(t.kind){case"stat":o.statSize=o.groups.reduce((a,s)=>a+s.statSize,0);break;case"source":{let a=o.groups.reduce((s,c)=>(s.parsedSize+=c.parsedSize,s.gzipSize+=c.gzipSize,s),{parsedSize:0,gzipSize:0});Object.assign(o,a)}}}t.children.clear()}}};function Ee(e){return new C(e)}function _(e){return new $(e)}var N=require("source-map"),Ie=new TextDecoder;async function ae(e){let t=await new N.SourceMapConsumer(e),i=(await t.sources).reduce((n,o)=>{let a=t.sourceContentFor(o,!0);return a&&n.push({id:o,code:a}),n},[]);return t.destroy(),i}function Le(e){let t=[],r=0;for(let i=0;i<e.length;i++)if(e[i]===10){let n=e.subarray(r,i);t.push(n),r=i+1}return r<e.length&&t.push(e.subarray(r)),t}function We(e,t){let r=t.reduce((n,o)=>{let{generatedLine:a}=o;return a in n||(n[a]=[]),n[a].push(o),n},{}),i="";for(let n in r){let o=parseInt(n)-1;if(e[o]){let a=Ie.decode(e[o]),s=r[n],c=s.length;for(let l=0;l<c;l++){let p=s[l],d=l+1>=c?null:s[l+1];if(c===1||p.lastGeneratedColumn===null){i+=a.substring(p.generatedColumn);continue}if(typeof p.lastGeneratedColumn=="number"){let y=p.lastGeneratedColumn+1===d?.generatedColumn?d.generatedColumn:p.lastGeneratedColumn;i+=a.substring(p.generatedColumn,y)}}}}return i}async function le(e,t,r){let i={},n=Le(e),o=await new N.SourceMapConsumer(t),a=Object.create(null);o.eachMapping(s=>{if(s.source){let c=r(s.source);c in a||(a[c]={mappings:[]}),a[c].mappings.push(s)}},null,N.SourceMapConsumer.ORIGINAL_ORDER);for(let s in a){let{mappings:c}=a[s];c.sort((l,p)=>l.generatedColumn-p.generatedColumn),c.length>0&&(i[s]=We(n,c))}return o.destroy(),i}var pe=[".mjs",".js",".cjs",".ts",".tsx",".vue",".svelte",".md",".mdx"],ce=process.cwd(),De=new TextEncoder;function Ge(e,t=ce){return e=M(e),e.replace(t,"").replace(/\0/,"")}function F(e,t=ce){let r=Ge(e,t);return z.default.isAbsolute(r)?r.replace("/",""):r}function $e(e,t,r){if(t in r)return r[t].source;throw new Error(`[analyzer error]: Missing sourcemap for ${e}.`)}function _e(e,t,r){let i={},n=e.type==="chunk";return i.code=L(n?e.code:e.source),i.map=$e(e.fileName,r,t),i.imports=n?e.imports:[],i.dynamicImports=n?e.dynamicImports:[],i.moduleIds=n?e.moduleIds:[],i.filename=e.fileName,i.isEntry=n?e.isEntry:!1,i}var H=class{originalId;id;label;parsedSize;mapSize;statSize;gzipSize;source;stats;imports;isAsset;isEntry;constructor(t,r){this.originalId=r,this.id=r,this.label=r,this.parsedSize=0,this.statSize=0,this.gzipSize=0,this.mapSize=0,this.source=[],this.stats=[],this.imports=new Set,this.isAsset=!0,this.isEntry=!1}addImports(...t){t.forEach(r=>this.imports.add(r))}async setup(t,r,i,n){let{imports:o,dynamicImports:a,map:s,moduleIds:c}=t;this.addImports(...o,...a),this.mapSize=s.length,this.isEntry=t.isEntry;let l=c.length?c.reduce((u,f)=>{let g=r.getModuleInfo(f);return g&&g.code&&(pe.includes(z.default.extname(g.id))||g.id.startsWith("\0"))&&u.push({id:g.id,code:g.code}),u},[]):await ae(s),p=_({meta:{statSize:0}}),d=_({kind:"source",meta:{gzipSize:0,parsedSize:0}});for(let u of l){if(u.id[0]==="."){let g=await r.resolve(u.id,this.originalId);if(!g)continue;u.id=g.id}let f=De.encode(u.code).byteLength;this.statSize+=f,p.insert(F(u.id,n),{kind:"stat",meta:{statSize:f}})}let y=await le(t.code,s,u=>{let f=z.default.relative(n,u);return z.default.join(n,f)});for(let u in y){if(!pe.includes(z.default.extname(u)))continue;let f=y[u],g=L(f),{byteLength:he}=await i(g),xe=g.byteLength;d.insert(F(u,n),{kind:"source",meta:{gzipSize:he,parsedSize:xe}})}p.mergePrefixSingleDirectory(),p.walk(p.root,(u,f)=>f.groups.push(u)),d.mergePrefixSingleDirectory(),d.walk(d.root,(u,f)=>f.groups.push(u)),this.stats=p.root.groups,this.source=d.root.groups;for(let u of this.source)this.gzipSize+=u.gzipSize,this.parsedSize+=u.parsedSize}};function He(e){return new H(F(e),e)}var K=class{compress;modules;workspaceRoot;pluginContext;chunks;constructor(t){this.compress=re(t),this.modules=[],this.pluginContext=null,this.chunks={},this.workspaceRoot=process.cwd()}installPluginContext(t){this.pluginContext||(this.pluginContext=t)}setupRollupChunks(t){this.chunks=t}async addModule(t,r){let i=_e(t,this.chunks,r),n=He(i.filename);await n.setup(i,this.pluginContext,this.compress,this.workspaceRoot),this.modules.push(n)}processFoamModule(){let r=(i=>{let n=(o,a=[])=>{let s=[...o.imports].flatMap(l=>this.modules.filter(p=>!a.includes(p.id)&&p.id===F(l))),c=s.map(l=>l.id).concat(a);return s.flatMap(l=>n(l,c)).concat(s)};return i.filter(o=>o.isEntry).reduce((o,a)=>(n(a).forEach(s=>{o[s.id]||(o[s.id]=new Set),o[s.id].add(a.id)}),o),{})})(this.modules);return this.modules.map(i=>({...P(i,["id","label","statSize","parsedSize","mapSize","gzipSize","source","stats","isAsset","isEntry"]),imports:Array.from(r[i.id]??[])}))}};function ue(e){return new K(e)}var de=m(require("http")),Z=m(require("fs")),R=m(require("path"));var Ke={".js":"application/javascript",".css":"text/css"};function Ze(e,t){let r=new Map;return function(n,o){let a=R.default.join(x,n.url);if(r.has(a)){let{data:s,mimeType:c}=r.get(a);o.writeHead(200,{"Content-Type":c}),o.end(s);return}if(n.url==="/"){o.setHeader("Content-Type","text/html; charset=utf8;");let s=Z.default.readFileSync(R.default.join(x,"index.html"),"utf8");s=s.replace(/<title>(.*?)<\/title>/,`<title>${e.title}</title>`),s=v({html:s,injectTo:"body",descriptors:{kind:"script",text:G(t,e.mode)}}),o.end(s),r.set(a,{data:s,mimeType:"text/html; charset=utf8;"});return}Z.default.readFile(a,(s,c)=>{if(s)o.statusCode=404,o.end("Not Found");else{let l=R.default.extname(a),p=Ke[l]||"application/octet-stream";o.writeHead(200,{"Content-Type":p}),o.end(c),r.set(a,{data:c,mimeType:p})}})}}function me(e=0){let t=de.default.createServer();return t.listen(e,()=>{console.log(`server run on http://localhost:${t.address().port}`)}),{setup:(i,n)=>{t.on("request",Ze(n,i))},get port(){return t.address().port}}}function fe(e){let t=P(e,["name","generateBundle","closeBundle","api"]),r=process.cwd(),{store:i}=t.api;return{...t,outputOptions(n){return n.dir&&(r=n.dir),i.analyzerModule.workspaceRoot=w(r),"sourcemap"in n&&(i.previousSourcemapOption=typeof n.sourcemap=="boolean"?n.sourcemap:n.sourcemap==="hidden"),typeof n.sourcemap=="boolean"&&n.sourcemap?n.sourcemap=!0:n.sourcemap="hidden",n}}}var Je=!!process.env.CI;function Ue(e){Q([e])}var ge=e=>V.default.dim(V.default.bold(e)),J=e=>ge(Y(e)),ye=e=>{let t=e.length,r=e.reduce((n,o)=>(n.gzip+=o.gzipSize,n.parsed+=o.parsedSize,n.map+=o.mapSize,n),{gzip:0,parsed:0,map:0}),i=[r.gzip&&`gzip: ${J(r.gzip)}`,r.map&&`map: ${J(r.map)}`].filter(Boolean).join(" | ");return`${ge(t)} chunks of ${J(r.parsed)} ${i?`(${i})`:""}`};function Ve(e,t){let{type:r}=e;if(r==="asset"&&k.default.extname(e.fileName)===".js"){let n=e.fileName+".map";return n in t?[!0,n]:[!0,null]}let i=r==="chunk";return[i,i?e.sourcemapFileName:null]}function qe(e={analyzerMode:"server",summary:!0}){let{reportTitle:t=B}=e,r=ue(e?.gzipOptions),i={previousSourcemapOption:!1,analyzerModule:r},n=process.cwd(),o=!0,a,s=process.cwd();return{name:B,apply:"build",enforce:"post",api:{store:i},configResolved(l){if(n=k.default.resolve(l.root,l.build.outDir??""),a=l.logger,s=w(l.root),r.workspaceRoot=s,e.summary){let p=l.plugins.find(d=>d.name==="vite:reporter");if(o=!!p?.writeBundle,p?.writeBundle){let d=typeof p.writeBundle=="function"?p.writeBundle:p.writeBundle?.handler,y=async function(...u){await d?.apply(this,u),a.info(ye(r.modules))};typeof p.writeBundle!="function"?p.writeBundle.handler=y:p.writeBundle=y}}},config(l){l.build?.sourcemap&&(i.previousSourcemapOption=typeof l.build.sourcemap=="boolean"?l.build.sourcemap:l.build.sourcemap==="hidden"),l.build||(l.build={}),typeof l.build.sourcemap=="boolean"&&l.build.sourcemap?l.build.sourcemap=!0:l.build.sourcemap="hidden"},async generateBundle(l,p){r.installPluginContext(this),r.setupRollupChunks(p);for(let d in p){let y=p[d],[u,f]=Ve(y,p);u&&f&&await r.addModule(y,f),i.previousSourcemapOption||u&&f&&Reflect.deleteProperty(p,f)}},async closeBundle(){switch(e.summary&&!o&&a.info(ye(r.modules)),e.analyzerMode){case"json":{let l=k.default.join(n,e.fileName?`${e.fileName}.json`:"stats.json"),p=r.processFoamModule();return U.default.writeFile(l,JSON.stringify(p,null,2),"utf8")}case"static":{let l=k.default.join(n,e.fileName?`${e.fileName}.html`:"stats.html"),p=r.processFoamModule(),d=await oe(p,{title:t,mode:"stat"});return U.default.writeFile(l,d,"utf8")}case"server":{let l=r.processFoamModule(),{setup:p,port:d}=me((e.analyzerPort==="auto"?0:e.analyzerPort)??8888);if(p(l,{title:t,mode:"stat"}),(e.openAnalyzer??!0)&&!Je){let y=`http://localhost:${d}`;Ue(y)}break}default:throw new Error("Invalidate Option `analyzerMode`")}}}}0&&(module.exports={adapter,analyzer});
